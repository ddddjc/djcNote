- 单点登录英文全称Single Sign On，简称SSO。
- 指在一个多系统应用群中登录其中一个，而可以访问所有应用而不用登录，包括单点登录和单点注销两部分

# 工作流程

## 1. 登录：

![img](https://cdn.jsdelivr.net/gh/mydy930657303/djcPicture@master/202308100920486.png)

描述：

- 若用户未登录访问受保护资源：
  1. 系统1发现在该系统下未登录
  2. 跳转至sso认证中心，并将被访问系统1资源地址作为参数
  3. 提交登录信息，sso认证中心校验用户信息，创建用户与sso的会话，称为全局会话，同时创建授权令牌
  4. sso认证中心带着令牌跳转到最初的请求地址（系统1）
  5. 系统1拿到令牌去ssso认证中心校验令牌是否生效
  6. sso认证中心校验令牌，返回生效信息，注册系统
  7. 系统1使用该令牌创建与用户的回话，称为局部系统，返回受保护资源。
- 用户登录后访问其他系统受保护资源：
  1. 系统2发现在该系统下未登录，跳转至sso认证中心，并将自己的地址作为参数‘
  2. sso发现用户已登录，跳转至系统2的资地址，并附带令牌
  3. 系统2拿到令牌，返回有效，注册系统2
  4. 系统2使用该令牌创建与用户的局部对话，返回受保护资源
- 用户登录成功之后，会与sso认证中心及各个子系统建立会话，用户与sso认证中心建立的会话称为全局会话，用户与各个子系统建立的会话称为局部会话，局部会话建立之后，用户访问子系统受保护资源将不再通过sso认证中心，全局会话与局部会话有如下约束关系
  1. 局部会话存在，全局会话一定存在
  2. 全局会话存在，局部会话不一定存在
  3. 全局会话销毁，局部会话必须销毁

## 2. 注销：

注销时，在一个子系统中注销，所有在系统的回话都将被注销

![3b139d2e-0b83-4a69-b4f2-316adb8997ce](https://cdn.jsdelivr.net/gh/mydy930657303/djcPicture@master/202308100937301.png)

1. 用户向系统1发送注销请求
2. 系统1根据用户与系统1建立的会话id拿到令牌，向sso认证中心发起注销请求
3. sso认证中心校验令牌有效，销毁全局会话，同时取出所有用此令牌注册的系统地址
4. sso认证中心向所有注册系统发起注销请求
5. 各注册系统接收sso认证中心的注销请求，销毁局部会话
6. sso认证中心接收引导用户至登录页面

# 部署图

单点登录涉及sso认证中心与众子系统，子系统与sso认证中心需要通信以交换令牌、校验令牌及发起注销请求，因而子系统必须集成sso的客户端，sso认证中心则是sso服务端，整个单点登录过程实质是sso客户端与服务端通信的过程，用下图描述

![fb29685c-487c-42b9-9ceb-6c7ee29e98c9](https://cdn.jsdelivr.net/gh/mydy930657303/djcPicture@master/202308100945952.png)

# 实现

sso采用客户端/服务端架构，实现看sso-client和sso-server要实现的功能

sso-client：

1. 拦截子系统未登录用户请求，跳转至sso认证中心
2. 接受并存储sso认证中心发送的令牌
3. 接收并存储sso认证中心发送的令牌
4. 与sso-server通信，校验令牌的有效性
5. 拦截用户注销求，向sso认证中心发送注销请求
6. 接收sso认证中心发送的注销请求，销毁局部会话

sso-server：

1. 验证用户的登录信息
2. 创建全局回话
3. 创建授权令牌
4. 与sso-client通信发送令牌
5. 校验sso-client令牌的有效性
6. 系统注册
7. 接收sso-client注销请求，注销所有会话



参考：
[单点登录原理与简单实现 - ywlaker - 博客园 (cnblogs.com)](https://www.cnblogs.com/ywlaker/p/6113927.html)
[单点登录(SSO)看这一篇就够了！这次不慌了 - 掘金 (juejin.cn)](https://juejin.cn/post/7044328327762411534)

