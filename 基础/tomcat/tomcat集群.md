## 1.简介：单个tomcat的承载能力是有限的，当一个tomcat服务器承载不住时，可以搭建tomcat集群。比较流行的是通过Nginx来实现负载均衡（关于[[基础/工具/Nginx|Nginx]]）
## 2.Nginx实现负载均衡的策略：
1. 轮询（Round Robin）：默认的负载均衡策略，Nginx将请求按照顺序依次分发给后端服务器，实现请求的均衡分配。
2. IP哈希（IP Hash）：基于客户端IP地址的哈希算法，将同一IP地址的请求始终分发给同一个后端服务器。这样可以保证同一客户端的请求都由同一台服务器处理，适用于需要保持会话状态的应用。
3. 最少连接（Least Connections）：Nginx会将请求分发给当前连接数最少的后端服务器，以实现连接数的均衡分配。这种策略适用于后端服务器负载不均的情况。
4. 加权轮询（Weighted Round Robin）：通过为每个后端服务器分配不同的权重，Nginx将请求按照权重比例分发给后端服务器。具有更高权重的服务器将处理更多的请求。
5. 加权最少连接（Weighted Least Connections）：结合了加权和最少连接的策略，Nginx将请求优先分发给连接数最少且权重较高的后端服务器。
此外，Nginx还支持自定义负载均衡策略，可以通过编写自定义的Nginx模块来实现特定的负载均衡算法。
## 3.tomcat集群产生的Seeion相关的问题以及解决方案
### 问题：用户登录时访问的是一个服务器，并会存贮对应的Session，如果后续操作可能会访问另一个tomcat服务器，而另一个tomcat服务器内则没有Session导致出现问题。
### 解决方案（Session共享）：
1. 使用IP哈希：通过Nginx转发，就IP地址的哈希算法，将同一IP地址始终发给同一服务器。
	- 存在问题：
	- 负载不均衡（某些子网客户端较多而某些较少，可能会导致负载不均衡），某个服务器压力较大而其他较小，影响性能。
	- 如果进行增加或减少服务器，进行rehash，重新分配服务器，可能会使某些对话失效
2. 通过Session复制：每次对Session进行修改，对其他服务器复制Session。
	- 存在问题：
	- 每修改一次，要进行 服务器数-1次复制，耗费大量网络带宽，降低应用性能。
	- 仅在小量集群使用，不推荐在较大集群使用，数大于等于4时不推荐使用。
3. [[小技术/sso-单点登录|sso-单点登录]]：比较流行的方案。把Session存放在redis里面，访问服务器时服务器像redis读取Session。登陆一次可以访问所有相互信任的系统。
![image.png](https://cdn.jsdelivr.net/gh/mydy930657303/djcPicture/202307051358890.png)
